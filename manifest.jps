{
  "jpsType": "install",
  "jpsVersion": "0.8",
  "application": {
    "name": "Git-Push-Deploy Example",
    "homepage": "https://github.com/jelastic-jps/git-push-deploy",
    "description": "Example of continuous integration (CI) with git-push-deploy ",
    "settings": {
	"fields": [{
		"name": "user",
		"caption": "GitHub User",
		"type": "string",
		"inputType": "string",
		"default": "sych74",
		"required": "true"
	}, {
		"name": "repo",
		"caption": "Repo URL",
		"type": "string",
		"inputType": "string",
		"default": "https://github.com/sych74/test",
		"required": "true"
	}, {
		"name": "token",
		"caption": "Auth Token",
		"type": "string",
		"inputType": "string",
		"default": "5beb41eaf3c71d4e9d78d5988dbd8e5fb056a36e",
		"required": "true"
	}]
    },
    "env": {
      "topology": {
        "nodes": [
          {
            "count": 1,
            "cloudlets": 16,
            "nodeGroup": "cp",
            "nodeType": "apache2"
          }
        ],
        "engine": "php5.6"
      }
    },
    "onInstall": [
      {
        "execScript": [
          {
            "type": "js",
            "script": "https://raw.githubusercontent.com/jelastic-jps/git-push-deploy/w/o-auth/scripts/add-git-project.cs",
            "params": {
              "url": "${settings.repo}",
              "branch": "master",
              "token": "${settings.token}"
            },
            "user": "root"
          }
        ]
      },
      {
        "call" : "after-deploy-hook"
      },
      {
        "log": "installed successfully"
      }
    ],
    "procedures": [
      {
        "id": "after-deploy-hook",
        "onCall": {
          "execCmd": {
            "nodeGroup": "cp",
            "user": "root",
            "commands": [
              "mkdir -p /opt/repo/ROOT/.git/hooks/",
              "printf '#!/bin/bash\nsudo /etc/init.d/cartridge reload >> /var/log/reload.log\n' > /opt/repo/ROOT/.git/hooks/post-merge",
              "chmod +x /opt/repo/ROOT/.git/hooks/post-merge"
            ]
          }
        }
      },
      {
        "id": "log",
        "onCall": {
          "log": "${this.message}"
        }
      }
    ]
  }
}
